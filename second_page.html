<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time 3D Cyberattack Map</title>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
        import Globe from 'https://unpkg.com/globe.gl/dist/globe.gl.module.js';

        // Create the globe
        const globe = Globe()
            .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-night.jpg') // Nighttime globe texture
            .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png') // Topology for 3D effect
            .width(window.innerWidth) // Fullscreen width
            .height(window.innerHeight) // Fullscreen height
            .showAtmosphere(true)
            .atmosphereColor('blue')
            .atmosphereAltitude(0.2)
            (document.getElementById('globe-container'));

        // Resize the globe on window resize
        window.addEventListener('resize', () => {
            globe.width([window.innerWidth]);
            globe.height([window.innerHeight]);
        });

        // Shodan Streaming API connection
        const API_KEY = "d2x5NJ4Fd5ES2NXqtbEuRgxbGQNEWwYG";
        const SHODAN_STREAM_URL = `wss://stream.shodan.io/shodan/alert?key=${API_KEY}`;

        const arcsData = []; // Array to store real-time arc data

        const socket = new WebSocket(SHODAN_STREAM_URL);
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.ip_str && data.location) {
                const { latitude, longitude } = data.location;
                const randomTarget = { lat: latitude + 5, lng: longitude + 5 }; // Mock random target location
                
                // Add real-time attack data to arcsData
                arcsData.push({
                    startLat: latitude,
                    startLng: longitude,
                    endLat: randomTarget.lat,
                    endLng: randomTarget.lng,
                    color: 'red'
                });

                // Update the globe with new arcs
                globe
                    .arcsData(arcsData)
                    .arcColor('color')
                    .arcAltitude(0.2)
                    .arcStroke(1.5)
                    .arcDashLength(0.5)
                    .arcDashGap(2)
                    .arcDashAnimateTime(4000);

                // Add markers for attack origins
                globe
                    .pointsData(arcsData.map(d => ({ lat: d.startLat, lng: d.startLng })))
                    .pointColor(() => 'red')
                    .pointAltitude(() => 0.05)
                    .pointRadius(0.2);
            }
        };

        socket.onerror = (error) => {
            console.error('WebSocket Error:', error);
        };

        socket.onclose = () => {
            console.warn('WebSocket connection closed');
        };
    </script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="globe-container"></div>
</body>
</html>
